<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Kaphisma Lookup</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; max-width:480px; margin:40px auto; padding:16px; }
    h1 { text-align:center; margin-bottom:18px; }
    form { display:flex; flex-direction:column; gap:12px; }
    label { font-size:14px; display:block; }
    input[type="text"], input[type="number"] {
      padding:10px 8px;
      font-size:16px;
      border:1px solid #ccc;
      border-radius:6px;
      width:100%;
      box-sizing:border-box;
    }
    button {
      padding:10px 14px;
      font-size:16px;
      background:#2ea44f;
      color:white;
      border:none;
      border-radius:6px;
      cursor:pointer;
    }
    button:disabled { opacity:0.6; cursor:default; }
    #result { margin-top:14px; font-size:18px; font-weight:600; text-align:center; }
    .small { font-size:13px; color:#666; text-align:center; margin-top:8px; }
  </style>
</head>
<body>
  <h1>Kaphisma Lookup</h1>

  <form id="kaphismaForm" onsubmit="return false;">
    <div>
      <label for="date">Date (MM/DD/YYYY):</label>
      <input id="date" name="date" type="text" placeholder="MM/DD/YYYY" aria-label="Date in MM slash DD slash YYYY" />
    </div>

    <div>
      <label for="person">Your Number (1-20):</label>
      <input id="person" name="person" type="number" min="1" max="20" placeholder="1" />
    </div>

    <div>
      <button id="calcBtn" type="button">Get My Kaphisma</button>
    </div>
  </form>

  <div id="result" aria-live="polite">Your Kaphisma: —</div>
  <div class="small">If you get an error, check the date format (MM/DD/YYYY) and that the number is 1–20.</div>

  <script>
    const DEFAULT_START_DATE = "11/28/2025";
    const DEFAULT_OFFSET = 5;

    function parseMMDDYYYY(str) {
      if (typeof str !== 'string') return null;
      const parts = str.trim().split('/');
      if (parts.length !== 3) return null;
      const m = parseInt(parts[0], 10);
      const d = parseInt(parts[1], 10);
      const y = parseInt(parts[2], 10);
      if ([m,d,y].some(v => Number.isNaN(v))) return null;
      return { year: y, month: m, day: d };
    }

    function computeKaphisma(startStr, dateStr, person, offset) {
      const s = parseMMDDYYYY(startStr);
      const t = parseMMDDYYYY(dateStr);
      if (!s || !t) return null;
      if (!Number.isInteger(person) || person < 1 || person > 20) return null;
      offset = Number.isFinite(offset) ? parseInt(offset, 10) : 0;

      const startUTC = Date.UTC(s.year, s.month - 1, s.day);
      const inputUTC = Date.UTC(t.year, t.month - 1, t.day);
      if (Number.isNaN(startUTC) || Number.isNaN(inputUTC)) return null;

      const msPerDay = 24 * 60 * 60 * 1000;
      const days = Math.floor((inputUTC - startUTC) / msPerDay);

      const raw = days + person + offset - 1;
      const mod = ((raw % 20) + 20) % 20;
      const kaphisma = mod + 1;
      return { kaphisma, days };
    }

    const dateInput = document.getElementById('date');
    const personInput = document.getElementById('person');
    const calcBtn = document.getElementById('calcBtn');
    const resultDiv = document.getElementById('result');

    calcBtn.addEventListener('click', () => {
      const dateStr = (dateInput.value || "").trim() || DEFAULT_START_DATE;
      const person = parseInt(personInput.value, 10);
      const res = computeKaphisma(DEFAULT_START_DATE, dateStr, person, DEFAULT_OFFSET);
      if (!res) {
        resultDiv.textContent = "Please enter a valid date (MM/DD/YYYY) and a number between 1 and 20.";
        resultDiv.style.color = 'crimson';
        return;
      }
      resultDiv.style.color = 'black';
      resultDiv.textContent = `Your Kaphisma: ${res.kaphisma}`;
    });

    personInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') calcBtn.click();
    });

    dateInput.value = DEFAULT_START_DATE;
    personInput.value = 5;
  </script>
</body>
</html>
